<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Đánh giá chất lượng Kiosk</title>
  <style>
    :root{
      --bg:#f3f6fb;
      --card:#ffffff;
      --primary:#0b63d5;
      --muted:#6b7280;
      --success:#16a34a;
      --danger:#ef4444;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#eaf2ff 0%, var(--bg) 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      box-sizing:border-box;
    }

    .card{
      width:850px;
      max-width:95%;
      background:var(--card);
      border-radius:16px;
      box-shadow:0 8px 30px rgba(12,30,60,0.08);
      padding:28px;
      text-align:center;
    }

    .title{
      font-size:26px;
      margin:0 0 8px 0;
      color:#0f172a;
      font-weight:600;
    }
    .subtitle{
      color:var(--muted);
      margin:0 0 22px 0;
      font-size:15px;
    }

    /* stars */
    .stars{
      display:flex;
      gap:18px;
      justify-content:center;
      align-items:center;
      margin:20px 0 18px;
      touch-action: manipulation;
    }

    .star-btn{
      width:84px;
      height:84px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      border:2px solid transparent;
      background:linear-gradient(180deg, rgba(11,99,213,0.06), rgba(11,99,213,0.02));
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s;
      cursor:pointer;
      user-select:none;
    }

    .star-btn:active{ transform: scale(.98); }
    .star-btn.small{ width:66px; height:66px; border-radius:10px; }

    .star-svg{
      width:40px;
      height:40px;
      display:block;
      fill: #cbd5e1;
      transition: fill .12s ease, transform .12s;
    }

    .star-btn.selected .star-svg{
      fill: #ffb020;
      transform: scale(1.05);
    }

    .star-btn.highlight{
      border-color: rgba(11,99,213,0.18);
      box-shadow: 0 6px 18px rgba(11,99,213,0.08);
      transform: translateY(-6px);
    }

    .note{
      color:var(--muted);
      font-size:14px;
      margin-top:8px;
    }

    .actions{
      margin-top:20px;
      display:flex;
      gap:12px;
      justify-content:center;
      align-items:center;
    }

    .btn{
      padding:14px 24px;
      border-radius:12px;
      border:0;
      font-weight:600;
      font-size:16px;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(12,30,60,0.06);
    }

    .btn-primary{
      background:var(--primary);
      color:white;
    }

    .btn-ghost{
      background:transparent;
      color:var(--primary);
      border:2px solid rgba(11,99,213,0.12);
    }

    .btn:disabled{
      opacity:.5;
      cursor:not-allowed;
    }

    .thanks{
      display:none;
      margin-top:20px;
      color:var(--success);
      font-weight:600;
    }

    /* for kiosk large fonts */
    @media (min-width:900px){
      .title{ font-size:30px; }
      .star-svg{ width:48px; height:48px; }
      .star-btn{ width:96px; height:96px; border-radius:16px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-labelledby="kioskTitle">
      <h1 id="kioskTitle" class="title">Đánh giá chất lượng Kiosk</h1>
      <p class="subtitle">Cảm ơn quý công dân đã sử dụng dịch vụ. Vui lòng đánh giá chất lượng kiosk từ 1 - 5 sao</p>

      <div id="ratingGroup" class="stars" role="radiogroup" aria-label="Đánh giá chất lượng kiosk">
        <!-- buttons generated by JS for accessibility -->
      </div>

      <div class="note" id="selectedNote" aria-live="polite"></div>

      <div class="actions">
        <button id="sendBtn" class="btn btn-primary" disabled aria-disabled="true">Gửi đánh giá</button>
        <button id="skipBtn" class="btn btn-ghost">Bỏ qua</button>
      </div>

      <div id="thanks" class="thanks" role="status" aria-live="polite">
        Cảm ơn bạn! Đánh giá đã được gửi.
      </div>
    </div>
  </div>

  <script>
    // Kiosk rating widget
    (function(){
      const ratingGroup = document.getElementById('ratingGroup');
      const selectedNote = document.getElementById('selectedNote');
      const sendBtn = document.getElementById('sendBtn');
      const skipBtn = document.getElementById('skipBtn');
      const thanks = document.getElementById('thanks');

      let currentRating = 0;

      // create 5 star buttons (1..5)
      for (let i = 1; i <= 5; i++) {
        const btn = document.createElement('button');
        btn.className = 'star-btn';
        btn.type = 'button';
        btn.setAttribute('role','radio');
        btn.setAttribute('aria-checked','false');
        btn.setAttribute('aria-label', i + ' sao');
        btn.dataset.value = i;
        btn.innerHTML = starSVG(); // svg markup
        // touch-friendly handlers
        btn.addEventListener('click', () => setRating(i));
        btn.addEventListener('touchstart', () => setRating(i));
        btn.addEventListener('pointerenter', () => highlightTo(i));
        btn.addEventListener('focus', () => highlightTo(i));
        btn.addEventListener('pointerleave', () => clearHighlight());
        btn.addEventListener('blur', () => clearHighlight());
        ratingGroup.appendChild(btn);
      }

      // keyboard support
      ratingGroup.addEventListener('keydown', (e) => {
        const key = e.key;
        if (key === 'ArrowLeft' || key === 'ArrowDown') {
          e.preventDefault();
          if (currentRating > 1) setRating(currentRating - 1);
        } else if (key === 'ArrowRight' || key === 'ArrowUp') {
          e.preventDefault();
          if (currentRating < 5) setRating(currentRating + 1);
        } else if (key === 'Enter' || key === ' ') {
          e.preventDefault();
          if (document.activeElement && document.activeElement.dataset.value) {
            setRating(Number(document.activeElement.dataset.value));
          }
        }
      });

      sendBtn.addEventListener('click', submitRating);
      skipBtn.addEventListener('click', skipRating);

      function setRating(n){
        currentRating = n;
        const buttons = ratingGroup.querySelectorAll('.star-btn');
        buttons.forEach(btn => {
          const val = Number(btn.dataset.value);
          btn.classList.toggle('selected', val <= n);
          btn.setAttribute('aria-checked', val === n ? 'true' : 'false');
        });
        sendBtn.disabled = false;
        sendBtn.setAttribute('aria-disabled', 'false');
        selectedNote.textContent = `Bạn đã chọn ${n} sao. Nhấn "Gửi đánh giá" để hoàn tất.`;
      }

      function highlightTo(n){
        const buttons = ratingGroup.querySelectorAll('.star-btn');
        buttons.forEach(btn => {
          const val = Number(btn.dataset.value);
          btn.classList.toggle('highlight', val <= n);
        });
      }

      function clearHighlight(){
        const buttons = ratingGroup.querySelectorAll('.star-btn');
        buttons.forEach(btn => btn.classList.remove('highlight'));
      }

      function submitRating(){
        if (!currentRating) return;
        // simulate sending (replace with real AJAX POST to server)
        const payload = {
          rating: currentRating,
          timestamp: new Date().toISOString(),
          kioskId: 'KIOSK-001' // optional: replace with real kiosk id
        };

        // show sending state
        sendBtn.disabled = true;
        sendBtn.textContent = 'Đang gửi...';
        sendBtn.setAttribute('aria-disabled', 'true');

        // Simulated async (for kiosk, you'd hit your API). Here use setTimeout to mimic.
        setTimeout(() => {
          // on success:
          // optionally: save to localStorage as log
          try {
            const log = JSON.parse(localStorage.getItem('kiosk_ratings')||'[]');
            log.push(payload);
            localStorage.setItem('kiosk_ratings', JSON.stringify(log));
          } catch(e) { /* ignore storage errors */ }

          thanks.style.display = 'block';
          sendBtn.textContent = 'Gửi đánh giá';
          sendBtn.disabled = true;
          selectedNote.textContent = '';
          // visual feedback: briefly show thanks then reset for next user
          setTimeout(resetForm, 2500);
        }, 700); // short delay for UX
      }

      function skipRating(){
        // optionally log skip
        const payload = { action: 'skip', timestamp: new Date().toISOString(), kioskId: 'KIOSK-001' };
        try {
          const log = JSON.parse(localStorage.getItem('kiosk_ratings')||'[]');
          log.push(payload);
          localStorage.setItem('kiosk_ratings', JSON.stringify(log));
        } catch(e){}
        thanks.textContent = 'Cảm ơn bạn!';
        thanks.style.color = '#0b63d5';
        thanks.style.display = 'block';
        setTimeout(resetForm, 2000);
      }

      function resetForm(){
        currentRating = 0;
        const buttons = ratingGroup.querySelectorAll('.star-btn');
        buttons.forEach(btn => {
          btn.classList.remove('selected','highlight');
          btn.setAttribute('aria-checked','false');
        });
        sendBtn.disabled = true;
        sendBtn.setAttribute('aria-disabled','true');
        selectedNote.textContent = '';
        thanks.style.display = 'none';
        // ready for next user (or navigate back to home)
      }

      // initial: focus first star for usability
      const firstBtn = ratingGroup.querySelector('.star-btn');
      if (firstBtn) firstBtn.setAttribute('tabindex', '0');

      // star SVG generator (accessible)
      function starSVG(){
        return `
          <svg class="star-svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M12 17.3l6.18 3.73-1.64-7.03L21 9.24l-7.19-.62L12 2 10.19 8.62 3 9.24l4.46 4.76L5.82 21z"/>
          </svg>
        `;
      }

      // For kiosk: auto reset after timeout of inactivity (optional)
      let inactivityTimer;
      function startInactivityTimer(){
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(() => {
          resetForm();
        }, 45 * 1000); // 45s idle reset
      }

      ['click','touchstart','pointerdown','keydown'].forEach(evt => {
        document.addEventListener(evt, startInactivityTimer, {passive:true});
      });
      startInactivityTimer();

    })();
  </script>
</body>
</html>
